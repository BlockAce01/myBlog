# Story: Implement Blog Post Search Bar

**Status**: Done

## Story

As a blog reader, I want to search for blog posts by keywords so that I can easily find relevant content.

## Acceptance Criteria

- The "Recent Posts" heading and description on the homepage are replaced with a search input field.
- The search input allows users to type keywords to search for blog posts.
- Search results are displayed in the existing post card grid.
- The search functionality works in conjunction with existing tag filters.
- Search queries should match against post titles, content, and tags.
- Real-time search with a 300ms debounce is implemented.
- A loading indicator is shown while search results are being fetched.
- A message indicating the number of search results is displayed.
- An empty state is displayed when no search results are found.

## Tasks

- [x] **Backend**: Create a new API endpoint for searching blog posts.
  - Endpoint: `GET /api/posts/search?q={query}&tag={tag}`
  - Parameters: `q` (search query string), `tag` (optional tag filter)
  - Implementation: Modify existing data service to handle search queries and update MongoDB queries to support text search across titles, content, and tags.
- [x] **Frontend**: Implement the search bar component on the homepage.
  - Replace the "Recent Posts" heading and description with an `Input` component for search.
  - Add a state variable `searchQuery` to manage the input value.
  - Implement a `handleSearch` function that debounces the search input and calls the backend API.
  - Update the `useEffect` hook to fetch posts based on `searchQuery` and `selectedTag`.
  - Display search results using the existing `PostCard` component.
  - Implement a loading state and an empty results state.
  - Display a count of search results.
- [x] **Frontend**: Integrate search with existing tag filtering.
  - Ensure that when a tag is selected, the search results are further filtered by that tag.
  - Ensure that clearing the search query or tag filter resets the results appropriately.

## Dev Notes

- Use `pnpm` for all package management.
- Frontend is Next.js 14+ with TypeScript, Tailwind CSS, shadcn/ui components.
- Backend is Node.js with Express.js, JavaScript (ES6+).
- Database is MongoDB Atlas.
- Ensure proper error handling for API calls.
- Consider accessibility for the search input and results.

## Testing

- Verify that typing in the search bar filters posts correctly.
- Verify that selecting a tag further filters the search results.
- Verify that clearing the search input or tag filter resets the results.
- Test edge cases: empty search query, no matching results, special characters in query.
- Verify loading state and empty state messages.
- Ensure the search is debounced correctly.

## Dev Agent Record

**Agent Model Used**: Cline
**Debug Log References**: N/A
**Completion Notes List**: N/A
**File List**:
- [x] `apps/frontend/app/page.tsx` (modified)
- [x] `apps/backend/src/api/posts.js` (modified)
- [x] `apps/backend/src/models/BlogPost.js` (modified for search index)
- [x] `apps/frontend/lib/data.ts` (modified)
- [x] `apps/frontend/hooks/use-debounce.ts` (new)
**Change Log**:
- Implemented backend search API endpoint.
- Implemented frontend search bar with debounce, loading state, empty state, and result count.
- Integrated search with existing tag filtering.
- Created `useDebounce` hook.
- Updated `getPosts` to accept tags.

## QA Results
**Reviewer**: Quinn (Test Architect & Quality Advisor)
**Date**: 9/16/2025

**Overall Assessment**: PASS. The implementation of the blog post search bar fully meets all specified acceptance criteria and adheres to project standards.

**Detailed Findings**:
- **Frontend (`apps/frontend/app/page.tsx`, `apps/frontend/lib/data.ts`, `apps/frontend/hooks/use-debounce.ts`)**:
    - The search input field correctly replaces the "Recent Posts" heading and description.
    - The `useDebounce` hook is correctly implemented and integrated, providing a 300ms debounce for search queries.
    - Search results are displayed in the existing `PostCard` grid.
    - Search functionality works seamlessly with existing tag filters, with `getPosts` and `searchPosts` in `data.ts` correctly handling tag parameters.
    - Loading indicators (`Skeleton` components) are displayed during data fetching.
    - The count of search results is accurately displayed.
    - Appropriate empty states are shown when no results are found.
- **Backend (`apps/backend/src/api/posts.js`, `apps/backend/src/models/BlogPost.js`)**:
    - A new API endpoint `GET /api/posts/search?q={query}&tag={tag}` has been successfully implemented.
    - The endpoint correctly utilizes MongoDB's text search (`$text: { $search: q }`) across `title`, `summary`, `content`, and `tags` fields, as enabled by the text index in `BlogPost.js`.
    - The endpoint correctly filters by `status: 'published'` and optionally by `tag`.
    - Error handling is present in API calls.

**Recommendations**: None. The implementation is robust and complete.
