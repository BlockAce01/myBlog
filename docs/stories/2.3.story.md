# Story 2.3: Implement Blog Post CRUD Endpoints

## Status
Done

## Story
**As a** developer,
**I want** to create the API endpoints for creating, reading, updating, and deleting blog posts,
**so that** the content can be managed programmatically.

## Acceptance Criteria
1.  A `POST /api/posts` endpoint is created to add a new blog post.
2.  A `GET /api/posts` endpoint is updated to retrieve a list of all blog posts from the database, with optional filtering by tags.
3.  A `GET /api/posts/:id` endpoint is updated to retrieve a single blog post by its unique ID from the database.
4.  A `PUT /api/posts/:id` endpoint is created to update an existing blog post.
5.  A `DELETE /api/posts/:id` endpoint is created to remove a blog post.
6.  All endpoints are tested and function correctly against a database.

## Tasks / Subtasks
- [x] Task 1 (AC: 1): Implement `POST /api/posts`.
  - [x] Subtask 1.1: In `apps/backend/src/api/posts.js`, create the `POST` route.
  - [x] Subtask 1.2: The handler should validate the request body and save a new post to the database.
- [x] Task 2 (AC: 2): Update `GET /api/posts`.
  - [x] Subtask 2.1: Modify the existing `GET /api/posts` endpoint to fetch all posts from the database instead of the hardcoded list.
  - [x] Subtask 2.2: Implement tag-based filtering (e.g., `?tags=tech,news`).
- [x] Task 3 (AC: 3): Update `GET /api/posts/:id`.
  - [x] Subtask 3.1: Modify the existing `GET /api/posts/:id` endpoint to fetch the post from the database.
- [x] Task 4 (AC: 4): Implement `PUT /api/posts/:id`.
  - [x] Subtask 4.1: Create the `PUT` route for `/api/posts/:id`.
  - [x] Subtask 4.2: The handler should find the post by ID, update it with the request body, and save it.
- [x] Task 5 (AC: 5): Implement `DELETE /api/posts/:id`.
    - [x] Subtask 5.1: Create the `DELETE` route for `/api/posts/:id`.
    - [x] Subtask 5.2: The handler should find the post by ID and remove it from the database.
- [x] Task 6 (AC: 6): Write tests for all CRUD operations.
  - [x] Subtask 6.1: In `apps/backend/src/api/posts.test.js`, add tests for creating, updating, and deleting posts.
  - [x] Subtask 6.2: Update existing tests to use a test database instead of hardcoded data.

## Dev Agent Record
### Agent Model Used
Claude 3.5 Sonnet

### Debug Log References
- `npm install --prefix apps/backend mongodb-memory-server` to install in-memory database for testing.
- `npm install --prefix apps/backend mongoose` to install mongoose.
- Fixed `author` field missing in `BlogPost` schema.

### Completion Notes List
- Implemented all CRUD operations for blog posts in `apps/backend/src/api/posts.js`.
- Created `apps/backend/src/models/BlogPost.js` for the Mongoose schema.
- Added MongoDB connection and `express.json` middleware to `apps/backend/src/index.js`.
- Updated `apps/backend/src/api/posts.test.js` to use `mongodb-memory-server` and cover all CRUD operations.
- All tests passed successfully.

### File List
- `apps/backend/src/models/BlogPost.js` (new)
- `apps/backend/src/index.js` (modified)
- `apps/backend/src/api/posts.js` (modified)
- `apps/backend/src/api/posts.test.js` (modified)

## Dev Notes
### Previous Story Insights
- This story replaces the hardcoded data from Stories 2.1 and 2.2 with a real database connection.
- It builds upon the database connection established in Story 2.2 (as per the epic).

### Data Models
- The `BlogPost` schema defined in `docs/architecture/4-data-models.md` will be used.

### API Specifications
- All endpoints should adhere to `docs/architecture/5-api-specification-rest.md`.

### File Locations
- `apps/backend/src/api/posts.js`
- `apps/backend/src/api/posts.test.js`

### Testing Requirements
- Tests should now interact with a test database.
- Mocks will be needed for database interactions to ensure tests are fast and isolated.
- Test cases should cover all success and error scenarios for each endpoint.

### Technical Constraints
- **Backend:** Node.js / Express
- **Database:** MongoDB with Mongoose
[Source: architecture/3-tech-stack.md]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-08-26 | 1.0 | Initial draft | Gemini |
| 2025-08-26 | 1.1 | Implemented CRUD endpoints and updated tests. | Cline |
