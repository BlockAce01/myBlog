# Story 1.7: Frontend-Backend Integration

## Status
Ready for Review

## Story
**As a** user,
**I want** to see the blog posts, comments, and likes on the website,
**so that** I can interact with the blog's content.

## Acceptance Criteria
1. The frontend application fetches and displays a list of blog posts from the backend API.
2. Clicking on a blog post navigates to a detail page and displays the full post content, including comments.
3. Users can submit new comments, and they are successfully saved to the backend.
4. Users can like a post, and the like count is updated in the backend and reflected on the UI.
5. The view count for a post is incremented when a user visits the post's detail page.
6. All frontend components that interact with the backend are connected and fully functional.

## Tasks / Subtasks
- [X] Task 1: Fetch and Display Blog Posts (AC: 1)
  - [X] Implement the API call to `GET /posts` in the frontend.
  - [X] Create or modify the UI to display the list of posts on the homepage.
- [X] Task 2: Implement Post Detail View (AC: 2, 5)
  - [X] Implement the API call to `GET /posts/:id`.
  - [X] Create the post detail page to display the full content.
  - [X] Implement the API call to `POST /analytics/views/:id` when the page loads.
- [X] Task 3: Implement Comments (AC: 2, 3)
  - [X] Implement the API call to `GET /posts/:id/comments`.
  - [X] Display the comments on the post detail page.
  - [X] Implement the form and API call for `POST /posts/:id/comments`.
- [X] Task 4: Implement Likes (AC: 4)
  - [X] Implement the UI for the like button.
  - [X] Implement the API call to `POST /analytics/likes/:id`.
  - [X] Update the UI to reflect the new like count.
- [ ] Task 5: End-to-End Testing (AC: 6)
  - [ ] Manually test the full user flow from viewing posts to commenting and liking.
  - [ ] Ensure there are no console errors in the browser.

## Dev Notes

### API Specifications
- All necessary backend endpoints are documented in `docs/architecture/5-api-specification-rest.md`.
- The frontend should connect to the following endpoints:
  - `GET /posts`
  - `GET /posts/:id`
  - `GET /posts/:id/comments`
  - `POST /posts/:id/comments`
  - `POST /analytics/views/:id`
  - `POST /analytics/likes/:id`
[Source: `docs/architecture/5-api-specification-rest.md`]

### Tech Stack
- **Frontend Framework:** Next.js (React)
- **Styling:** Tailwind CSS
[Source: `docs/architecture/3-tech-stack.md`]

### File Locations
- All frontend code is located in `apps/frontend`.
- API interaction logic should be placed in a dedicated services or hooks directory within the frontend application.
[Source: `docs/architecture/7-unified-project-structure-source-tree.md`]


## QA Results

### Review Date: 2025-08-31

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation connects the frontend and backend as per the story's requirements. However, there are several areas for improvement regarding code quality, security, and testing.

### Refactoring Performed

- **File**: `apps/backend/src/api/analytics.test.js`
  - **Change**: Fixed failing tests for the `/analytics/likes/:id` endpoint.
  - **Why**: The original tests were not sending the required `userId` in the request body and were incorrectly mocking the database calls.
  - **How**: Updated the tests to send a `userId` and to correctly mock the `BlogPost.findById` and `post.save()` methods.

### Compliance Check

- Coding Standards: [✗] `coding-standards.md` not found.
- Project Structure: [✓]
- Testing Strategy: [✗] `testing-strategy.md` not found.
- All ACs Met: [✓] Functionally met, but with quality and security concerns.

### Improvements Checklist

- [X] Fixed failing backend tests.
- [ ] Add frontend tests (unit, integration, and E2E).
- [ ] Use environment variables for the API URL instead of hardcoding it.
- [ ] Refactor frontend components to use Server-Side Rendering (SSR) or Static Site Generation (SSG) for better performance.
- [ ] Implement a proper authentication system instead of relying on a client-generated `userId`.

### Security Review

The current implementation has a significant security vulnerability. The `userId` is generated on the client-side and stored in `localStorage`, which can be easily manipulated by a user. This could lead to users liking posts on behalf of other users. A proper authentication and authorization mechanism is required.

### Performance Considerations

The frontend components are using client-side data fetching (`"use client"`). For a blog, which is mostly static content, it would be more performant to use Next.js's server-side rendering (SSR) or static site generation (SSG) capabilities. This would lead to faster page loads and better SEO.

### Files Modified During Review

- `apps/backend/src/api/analytics.test.js`

### Gate Status

Gate: CONCERNS → docs/qa/gates/1.7-frontend-backend-integration.yml

### Recommended Status

[✗ Changes Required - See unchecked items above]
