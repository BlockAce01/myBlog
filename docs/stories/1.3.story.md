# Story 1.3: Data Models & Database Connection

## Status
Done

## Story
**As a** developer,
**I want** defined Mongoose schemas and a database connection,
**so that** I can store and retrieve blog data in MongoDB.

## Acceptance Criteria
1. Mongoose schemas created for BlogPost and Comment models
2. Connection established to MongoDB using Mongoose
3. Connection tested locally
4. Models exported for use in API endpoints

## Tasks / Subtasks
- [x] Task 1: Create BlogPost schema
  - [x] Define schema matching interface
  - [x] Add required fields validation
- [x] Task 2: Create Comment schema
  - [x] Define schema matching interface
  - [x] Add required fields validation
- [x] Task 3: Establish MongoDB connection
  - [x] Install Mongoose dependency
  - [x] Create connection utility
  - [x] Add connection to backend startup
- [x] Task 4: Test connection
  - [x] Verify connection on app startup
  - [x] Add error handling
- [x] Task 5: Implement automated tests for database connection
  - [x] Create `db.test.js`
  - [x] Set up test environment (using local MongoDB)
  - [x] Write test cases for successful connection, connection failure, and disconnection
  - [x] Run automated tests
- [x] Task 6: Refactor database connection utility
  - [x] Extract connection logic to `apps/backend/src/utils/db.js`
  - [x] Update `apps/backend/src/index.js` to use the new utility
- [x] Task 7: Update API tests
  - [x] Fix `apps/backend/src/api/posts.test.js` failures by aligning with `BlogPost` schema

## Dev Notes
### Data Models
```typescript
// BlogPost
{
  _id: string;
  title: string;
  summary: string;
  content: string; // Markdown
  coverPhotoUrl: string;
  tags: string[];
  publicationDate: Date;
  viewCount: number;
  likeCount: number;
}

// Comment
{
  _id: string;
  postId: string; // Reference to BlogPost
  authorName: string;
  commentText: string;
  createdAt: Date;
}
```
[Source: architecture/4-data-models.md]

### Technical Constraints
- MongoDB connection string: `mongodb://localhost:27017/myblog`
- Use Mongoose ODM
- Connection should be established at application startup

### File Locations
- Models: `apps/backend/src/models/BlogPost.js`, `apps/backend/src/models/Comment.js`
- Connection utility: `apps/backend/src/utils/db.js`

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-08-29 | 1.0 | Initial draft | Bob (Scrum Master) |
| 2025-08-29 | 1.1 | Refactored MongoDB connection utility, implemented automated tests for database connection, and fixed existing API test failures. | Cline |
