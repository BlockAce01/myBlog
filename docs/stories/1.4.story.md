# Story 1.4: Implement All Public Backend APIs

## Status
Done

## Story
**As a** user,
**I want** to be able to view, comment on, and like blog posts,
**so that** I can interact with the content on the blog.

## Acceptance Criteria
1. All public-facing API endpoints for posts are implemented and tested.
2. All public-facing API endpoints for comments are implemented and tested.
3. All public-facing API endpoints for likes are implemented and tested.
4. All public-facing API endpoints for view counts are implemented and tested.
5. API endpoints for tag filtering are implemented and tested.
6. All endpoints match the specifications in `5-api-specification-rest.md`.

## Tasks / Subtasks
- [X] Task 1: Implement Blog Post Endpoints (AC: 1, 5, 6)
  - [X] `GET /posts`: Get a list of all posts with tag filtering.
  - [X] `GET /posts/:id`: Get a single post by its ID.
- [X] Task 2: Implement Comment Endpoints (AC: 2, 6)
  - [X] `GET /posts/:id/comments`: Get all comments for a post.
  - [X] `POST /posts/:id/comments`: Add a new comment to a post.
- [X] Task 3: Implement Analytics Endpoints (AC: 3, 4, 6)
  - [X] `POST /analytics/views/:id`: Increment the view count for a post.
  - [X] `POST /analytics/likes/:id`: Increment the like count for a post.
- [X] Task 4: Implement Automated Tests for all Endpoints
  - [X] Create test files for each new route.
  - [X] Write unit and integration tests for all public endpoints.
  - [X] Ensure tests cover successful cases, error cases, and edge cases.

## Dev Notes

### Previous Story Insights
The database connection and Mongoose models (`BlogPost`, `Comment`) are established and available for use. The connection utility is located at `apps/backend/src/utils/db.js`.

### Data Models
- **BlogPost**: Represents a single article.
  ```typescript
  interface BlogPost {
    _id: string;
    title: string;
    summary: string;
    content: string; // Markdown
    coverPhotoUrl: string; // URL to the image in S3
    tags: string[];
    publicationDate: Date;
    viewCount: number;
    likeCount: number;
  }
  ```
  [Source: `docs/architecture/4-data-models.md`]
- **Comment**: Represents a single user comment on a post.
  ```typescript
  interface Comment {
    _id: string;
    postId: string; // Reference to BlogPost
    authorName: string;
    commentText: string;
    createdAt: Date;
  }
  ```
  [Source: `docs/architecture/4-data-models.md`]

### API Specifications
- **Blog Service (`/posts`)**
  - `GET /posts`: Get a list of all posts. Query Params: `?tags=react,devops` for filtering.
  - `GET /posts/:id`: Get a single post by its ID.
  - `GET /posts/:id/comments`: Get all comments for a post.
  - `POST /posts/:id/comments`: Add a new comment to a post.
- **Analytics Service (`/analytics`)**
  - `POST /analytics/views/:id`: Increment the view count for a post.
  - `POST /analytics/likes/:id`: Increment the like count for a post.
[Source: `docs/architecture/5-api-specification-rest.md`]

### File Locations
- API routes should be organized by service in `apps/backend/src/api/`.
- Business logic should be in `apps/backend/src/services/`.
- Mongoose models are in `apps/backend/src/models/`.
[Source: `docs/architecture/7-unified-project-structure-source-tree.md`]

### Testing
- Use Jest for testing.
- Test files should be co-located with the code they are testing (e.g., `posts.test.js` alongside `posts.js`).
- Tests should cover all public API endpoints.
[Source: `docs/architecture/3-tech-stack.md`]

## Dev Agent Record
- **Agent Model Used**:
- **Debug Log References**:
- **Completion Notes List**:
  - Implemented automated tests for all public API endpoints.
  - Fixed a bug in the `POST /posts/:postId/comments` endpoint where the saved comment was not being returned.
  - All tests are passing.
- **File List**:
  - `apps/backend/src/api/posts.test.js`
  - `apps/backend/src/api/analytics.test.js`
  - `apps/backend/src/api/posts.js`
- **Change Log**:
  - 2025-08-29 | 1.0 | Initial draft | Bob (Scrum Master)
  - 2025-08-30 | 1.1 | reviewed | Alice (QA)
