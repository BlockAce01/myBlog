# Story 1.8: Local Multi-Container Setup

## Status
New

## Story
**As a** developer,
**I want** to create a docker-compose.yml file to easily run the entire full-stack application (frontend, all backend services, and a MongoDB database) locally with a single command (docker-compose up),
**so that** I can easily run and test the entire application.

## Acceptance Criteria
- A `docker-compose.yml` file is created
- The entire full-stack application can be started with `docker-compose up`
- All services are accessible and working correctly

## Tasks / Subtasks
- [x] Task 1: Create `docker-compose.yml` file
  - [x] Define version and services
  - [x] Configure frontend service (Next.js)
  - [x] Configure backend service (Node.js/Express)
  - [x] Configure MongoDB service
  - [x] Set up network configuration
- [ ] Task 2: Verify the application runs with `docker-compose up`

## Dev Agent Record
- Agent Model: dev
- Debug Log References: 
  - Docker build/run failed with "500 Internal Server Error" and "unable to get image" errors, indicating a Docker daemon or environment configuration issue on the host system.
  - Frontend build failing due to incorrect Dockerfile for pnpm workspace.
- Completion Notes: 
  - Task 1 completed: Created docker-compose.yml with frontend, backend, and MongoDB services.
  - Task 2 unblocked: Fixed Dockerfile and docker-compose.yml for frontend service.
- File List: 
  - `docker-compose.yml`
  - `apps/frontend/Dockerfile`
  - [ ] Check frontend accessibility
  - [ ] Test API endpoints
  - [ ] Verify database connectivity

## Dev Notes
### Docker Configuration
- Use Docker Compose version 3.8 or higher
- Frontend service:
  - Image: node:20-alpine
  - Build context: `apps/frontend`
  - Ports: `3000:3000`
  - Environment: `NODE_ENV=development`
  - Command: `pnpm dev`
- Backend service:
  - Image: node:20-alpine
  - Build context: `apps/backend`
  - Ports: `5000:5000`
  - Environment: `MONGODB_URI=mongodb://mongo:27017/myBlog`, `NODE_ENV=development`
  - Command: `pnpm start`
- MongoDB service:
  - Image: mongo:latest
  - Ports: `27017:27017`
  - Volumes: `mongo-data:/data/db`
- Networks:
  - Create network `myBlog-network` for inter-service communication
- Volumes:
  - Define volume `mongo-data` for database persistence

[Source: architecture/3-tech-stack.md]

## Testing
1. Run `docker-compose up` and verify:
   - Frontend accessible at http://localhost:3000
   - Backend API responds at http://localhost:5000/api/hello
   - MongoDB connection established in backend logs
2. Test data persistence:
   - Create a blog post
   - Stop containers
   - Restart containers
   - Verify blog post still exists

## Dev Agent Record
- Agent Model: BMad Master Task Executor
- Debug Log References: 
  - Docker build/run failed with "500 Internal Server Error" and "unable to get image" errors, indicating a Docker daemon or environment configuration issue on the host system.
- Completion Notes: 
  - Task 1 completed: Created docker-compose.yml with frontend, backend, and MongoDB services.
  - Task 2 blocked: Unable to verify Docker Compose setup due to host Docker environment issues.
- File List: 
  - `docker-compose.yml`
  - `apps/frontend/Dockerfile`

## Completion Notes
- [ ] All tasks completed
- [ ] All tests passed (Blocked due to Docker environment issue)

## Change Log
- 2025-08-31: Initial story creation
- 2025-08-31: Updated commands to use pnpm and corrected backend command
